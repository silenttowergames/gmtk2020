!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.v2d=void 0;var o=function(){function e(){this.X=0,this.Y=0}return e.create=function(t,n){var o=new e;return o.X=t,o.Y=n,o},e}();t.v2d=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.component=void 0;var o=function(){function e(){this.active=!0}return e.prototype.class=function(){throw new Error("No class name!")},e}();t.component=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.system=void 0;var o=function(){function e(){}return e.prototype.update=function(e){throw new Error("System not implemented!")},e}();t.system=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.input=void 0;var o=function(){function e(){}return e.init=function(){e.keys={down:[],held:[]},window.addEventListener("keydown",(function(t){return e.key(t.key,!0)})),window.addEventListener("keyup",(function(t){return e.key(t.key,!1)}))},e.key=function(t,n){e.keys.down[t]||(e.keys.down[t]=0),e.keys.held[t]||(e.keys.held[t]=0),e.keys.held[t]=n?Math.max(1,e.keys.held[t]+1):-1},e.update=function(){for(var t in e.keys.held)e.held(t)<=0?e.keys.down[t]=Math.max(Math.min(-1,e.down(t)-1),-80):e.keys.down[t]=Math.max(1,e.down(t)+1)},e.down=function(t){return e.keys.down[t]?e.keys.down[t]:0},e.held=function(t){return e.keys.held[t]?e.keys.held[t]:0},e}();t.input=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.i=void 0,t.i=function(e){return document.querySelector('[src="assets/'+e+'.png"]')}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(6),r=n(8),a=n(9),i=n(0),s=n(10),d=n(11),c=n(12),u=n(13),l=n(3),p=n(14),h=n(15),f=n(16),y=n(17),w=n(18),v=n(19),m=n(20),g=n(22),b=n(21);window.addEventListener("load",(function(){var e,t=o.canvas.create("c",320,180),n=[a.SpriteSheet.create("8x8",i.v2d.create(8,8),{protagLeft:[[0,0,0]],protagRight:[[1,0,0]],weed:[[2,1,15],[3,1,15],[0,2,15],[1,2,15]],corn:[[2,2,0]],fire:[[0,3,5],[1,3,5],[2,3,5],[3,3,5]]}),a.SpriteSheet.create("endcard",i.v2d.create(320,180),{only:[[0,0,0]]}),a.SpriteSheet.create("store",i.v2d.create(320,180),{only:[[0,0,0]]}),a.SpriteSheet.create("store2",i.v2d.create(320,180),{only:[[0,0,0]]})],_={farm1:function(){var t;t=e.new(),e.add(t,y.TileMap.create("farm1")),e.add(t,s.body.create(0,12)),t=e.new(),e.add(t,new h.AIPlayer),e.add(t,s.body.create(192,124)),e.add(t,d.sprite.create(n[0],"protagLeft")),t=e.new(),e.add(t,s.body.create(2,2)),e.add(t,w.TextC.create("Plant & Water")),t=e.new(),e.add(t,s.body.create(192,2)),e.add(t,w.TextC.create("Seed [X] Dig [C]"))},farm2:function(){var t;t=e.new(),e.add(t,y.TileMap.create("farm2")),e.add(t,s.body.create(0,12)),t=e.new(),e.add(t,new h.AIPlayer),e.add(t,s.body.create(264,116)),e.add(t,d.sprite.create(n[0],"protagLeft")),t=e.new(),e.add(t,s.body.create(2,2)),e.add(t,w.TextC.create("Rows of Corn")),t=e.new(),e.add(t,s.body.create(192,2)),e.add(t,w.TextC.create("Seed [X] Dig [C]"))},farm3:function(){var t;t=e.new(),e.add(t,y.TileMap.create("farm3")),e.add(t,s.body.create(0,12)),t=e.new(),e.add(t,new h.AIPlayer),e.add(t,s.body.create(112,52)),e.add(t,d.sprite.create(n[0],"protagLeft")),t=e.new(),e.add(t,s.body.create(2,2)),e.add(t,w.TextC.create("Bridge the Gap")),t=e.new(),e.add(t,s.body.create(192,2)),e.add(t,w.TextC.create("Seed [X] Dig [C]"))},firstYearStore:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[2],"only")),t=e.new(),e.add(t,s.body.create(8,128)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["Welcome in, Saul!\n\nWhat is it you need?","pHey there, Ed. I need some manure,\nand a new shovel.","Alrighty, here you go. No seed?","pYou know I use my own seed every year.","Just checking! You never know.\n\nHave a good one.","pYou too!"],"farm1")),t=e.new(),e.add(t,new g.Fader)},secondYearStore:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[2],"only")),t=e.new(),e.add(t,s.body.create(8,128)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["Hey there Saul.\n\nHow'd the year go?","pAbout as good as any other.\n\nNeed some more manure.","Well, I got some bad news.\nLooks like your usual brand got put\nout of business. All we've got is\nthis new kind.","pOut of business? How's that?","This new kind's cheap...\n\nSo cheap it seems wrong, in fact.\nNobody else can't compete.","pWell... I guess I'll take it, if\nit's all you got.","pIf it's cheaper, maybe I'll end\nup with more money in the end.","That's the idea I guess.\n\nMaybe it's a good thing.","pWhat's this on the back of the bag?","I'm telling you Saul, I looked all\nover it. That's the correct price.","pNo, this here. It says it might\nkill my seeds if I don't use their\nbrand?","What?! Show me...","The hell? Looks like this manure\nmight kill your seeds!","pYou don't say, Ed?","pWhat am I supposed to do about that?!","Well, I've got some new seeds here.\nSame brand, in fact.\n\nJust arrived this week.","pConvenient.\n\nThere goes all the money I saved, I\nguess.","You'll get 'em next year."],"thirdYearBible")),t=e.new(),e.add(t,new g.Fader)},thirdYearStore:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[2],"only")),t=e.new(),e.add(t,s.body.create(8,128)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["Another year, another dollar.\n\nWhat'll it be this time?","pMy farm is all grown up with some\nkind of weed I ain't never seen\nbefore!","Oh yeah, getting a lot of reports\nof that.","Rumor has it...\n\nIt's the manure!","pSounds about right. Can you order me\nin some other kind?","Sorry... it's the only kind they make\nanymore. Everyone else got run out.","pWhat?!","pWhat am I supposed to do about the\nweeds?","I hear they catch fire faster than\nanything else.\n\nDo with that what you may.","Unrelated: we have a special going \non kerosene."],"fourthYearBible")),t=e.new(),e.add(t,new g.Fader)},fourthYearStore:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[2],"only")),t=e.new(),e.add(t,s.body.create(8,128)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["Howdy, Saul. Any luck this last year?","pHardly.\n\nNothing's grown back from the fires.","Yeah... Those weeds are known to suck\nthe nutrients clean out of the land.","pWhat do you do for the dead soil?\n\nAny rumors?","Decorative tombstones?","pReal funny.","Well...","They sell this extra-strength\nfertilizer.","Says it'll make a seaweed grow\nin the desert.","pI guess I'll take it...\n\nHow much?","How expensive do you reckon it is to\nmake a seaweed grow in the desert?","That's how much.","pWell, spare no expense.\n\nFarmers are made of money, after all.","Yeah, I think all these new\nconcoctions...","I think they've got something to do\nwith the mark of the beast.","pI hate 'em as much as the next guy,\nbut that's what you said about the\ncredit card machine, too, Ed.","Well I'm right one way or the other,\nain't I?","pCan't argue with that, I guess."],"fifthYearBible")),t=e.new(),e.add(t,new g.Fader)},fifthYearStore:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[2],"only")),t=e.new(),e.add(t,s.body.create(8,128)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["Hey there Saul, doing okay?","pI'm flat broke.","Sorry to hear it.\n\nI get that a lot these days, it seems.","pUsed to be, a man could make a living\noff the land. But anymore...\n\nI don't know.","Well, I've got a bit of good news.","The bank is generously offering loans\nto my distinguished clientele\nduring their time of need!","pWhat?","Low-interest business loans! They're\navailable for anyone that creates\njobs in our local agriculture sector!","pWhy are you talking like that?","Like what?","pLike you're trying to sell me\nsomething.","Aren't I always trying to sell you\nsomething?","p...","...","I had to refinance the store... they\noffered me a good deal, if I do\nexactly as they say.","Well, are you interested?","pI don't have much of a choice, I\nsuppose...","Great!\n\nJust sign here...","pHere you go.","Thank you. And,\n\nI'm sorry."],"sixthYearBible")),t=e.new(),e.add(t,new g.Fader)},sixthYearStore:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[3],"only")),t=e.new(),e.add(t,s.body.create(8,128)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["rHello, fine patron!\n\nHow are you all?","pWho the hell are you?!","rI am the proprieter of this\nestablishment.\n\nHow may I help you?","pWhere's Ed? What happened?\n\nDid he die?!","rOh no, he's very much alive!","rThis job didn't seem to work very\nwell for him, so he's been relocated\nto one of our workhouses.","pWorkhou- what?","rHow may I help you?","p...","pWell, I need manure & seeds.","pAnd some of that severely overpriced\nstuff.","pAnd some kerosene, I guess.","rSeverely over- ah!\n\nYou mean...","pThe super-fertilizing... whatever.","rYes!\n\nIt'll make seaweed grow in the desert!","pAnd it made mushrooms grow on my\nshoes.","pAnd weeds grow right back where I got\nrid of 'em.\n\nBut I can't do without it anymore.","rIt's that good!\n\nWell, here you go!","rOh, and remember...","rRemember to keep on time with your\npayments.","pPayments?","rThe loan I gave you.","pYou?\n\nI've never seen you before in my life!","rAnd yet...\n\t\nYou knew exactly who I was,\nthe moment you saw me.","rDidn't you?","rHave a nice day."],"firstYearBible")),t=e.new(),e.add(t,new g.Fader)},firstYearBible:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["18. [...] it is good and comely for\none to eat and to drink, and to enjoy\nthe good of all his labour that he\ntaketh under the sun all the days\nof his life [...]\n    Ecclesiastes 5:18"],"firstYearStore")),t=e.new(),e.add(t,new g.Fader)},secondYearBible:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["12. The wicked plotteth against the\njust, and gnasheth upon him with his\nteeth.\n    Psalm 37:12"],"secondYearStore")),t=e.new(),e.add(t,new g.Fader)},thirdYearBible:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["25. But while men slept, his enemy\ncame and sowed tares among the wheat,\nand went his way.\n    Matthew 13:25"],"thirdYearStore")),t=e.new(),e.add(t,new g.Fader)},fourthYearBible:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["2. And the angel of the Lord appeared\nunto him in a flame of fire out of\nthe midst of a bush: and he looked,\nand, behold, the bush burned with\nfire, and the bush was not consumed.\n    Exodus 3:2"],"fourthYearStore")),t=e.new(),e.add(t,new g.Fader)},fifthYearBible:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["20. I cry unto thee, and thou dost not\nhear me: I stand up, and thou\nregardest me not.\n    Job 30:20"],"fifthYearStore")),t=e.new(),e.add(t,new g.Fader)},sixthYearBible:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["15. And he had power to give life unto\nthe image of the beast, that the image\nof the beast should both speak, and\ncause that as many as would not\nworship the image of the beast\nshould be killed.","16. And he causeth all, both small and\ngreat, rich and poor, free and bond,\nto receive a mark in their right\nhand, or in their foreheads.","17. That no man might buy or sell,\nsave he that had the mark, or the name\nof the beast, or the number of his\nname.\n    Revelation 13:15-17"],"sixthYearStore")),t=e.new(),e.add(t,new g.Fader)},ending:function(){var t;t=e.new(),e.add(t,s.body.create(0,0)),e.add(t,d.sprite.create(n[1],"only")),t=e.new(),e.add(t,s.body.create(8,104)),e.add(t,w.TextC.create("")),e.add(t,v.TextRead.create(["3. And the battle went sore against Saul,\n"],"ending")),t=e.new(),e.add(t,new g.Fader)}},x=null;setInterval((function(){null==e&&(x="ending")||null!=e.nextScene&&(x=e.nextScene)?((e=function(e){var t=r.world.create();return t.canvas=e,t.systems.push(new f.AIPlayerSystem),t.systems.push(new p.MoveSystem),t.systems.push(new u.AnimationSystem),t.systems.push(new m.TextReadSystem),t.systems.push(new b.FaderSystem),t.systems.push(new c.DrawSystem),t}(t)).spriteSheets=n,window.tiles.index=[],_[x](),x=null):e.focused&&(e.progress(),l.input.update())}),1e3/60),document.addEventListener("focus",(function(){return e.focused=!0})),document.addEventListener("blur",(function(){return e.focused=!1})),l.input.init()}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.canvas=void 0;var o=n(0),r=n(7),a=function(){function e(){}return e.create=function(t,n,a){var i=new e;return i.cam=r.camera.create(),i.size=o.v2d.create(n,a),i.zoom=1,i.element=document.getElementById(t),i.ctx=i.element.getContext("2d"),i.refresh(),window.addEventListener("resize",(function(){return i.refresh()})),i},e.prototype.refresh=function(){var e=o.v2d.create(window.innerWidth,window.innerHeight);this.zoom=Math.min(e.X/this.size.X,e.Y/this.size.Y),this.zoom>1&&(this.zoom=Math.floor(this.zoom)),this.element.width=this.size.X*this.zoom,this.element.height=this.size.Y*this.zoom},e}();t.canvas=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.camera=void 0;var o=n(0),r=function(){function e(){}return e.create=function(){var t=new e;return t.position=o.v2d.create(0,0),t.zoom=1,t},e}();t.camera=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.world=void 0;var o=function(){function e(){this.entityCount=0,this.focused=!0,this.nextScene=null}return e.create=function(){var t=new e;return t.components={all:[],types:{}},t.systems=[],t},e.prototype.new=function(){return this.entityCount++},e.prototype.addComponent=function(e){var t=e.class();this.components.all.push(e),this.components.types[t]||(this.components.types[t]=[]),this.components.types[t].push(e)},e.prototype.add=function(e,t){t.entity=e,this.addComponent(t)},e.prototype.remove=function(e){for(var t=[],n=0;n<this.components.all.length;n++){var o=this.components.all[n];if(o.entity==e){t.push(n);var r=o.class(),a=void 0;a=this.components.types[r].indexOf(o),this.components.types[r].splice(a,1)}}for(var i=0,s=t;i<s.length;i++){a=s[i];this.components.all.splice(a,1)}},e.prototype.progress=function(){for(var e=0,t=this.systems;e<t.length;e++){t[e].update(this)}},e.prototype.get=function(e){var t;return null!==(t=this.components.types[e])&&void 0!==t?t:[]},e.prototype.getEntitiesWith=function(e){for(var t=[],n=0,o=this.get(e);n<o.length;n++){var r=o[n];t.push(r.entity)}return t},e.prototype.getComponentForEntity=function(e,t){for(var n=0,o=this.get(t);n<o.length;n++){var r=o[n];if(r.entity==e)return r}return null},e}();t.world=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpriteSheet=void 0;var o=n(4),r=function(){function e(){}return e.create=function(t,n,r){var a=new e;return a.asset=o.i(t),a.filename=t,a.animations=r,a.tilesize=n,a},e}();t.SpriteSheet=r},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.body=void 0;var a=n(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e,n,o){void 0===o&&(o=!0);var r=new t;return r.position=a.v2d.create(e,n),r.velocity=new a.v2d,o&&(r.index=r.position.X/8+Math.floor((r.position.Y-12)/8*40),window.tiles.index[r.index]=1),r},t.prototype.class=function(){return"body"},t}(n(1).component);t.body=i},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.sprite=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flipX=!1,t.frameID=0,t.frameDuration=0,t}return r(t,e),t.create=function(e,n){var o=new t;return o.animationID=n,o.sheet=e,o},t.prototype.class=function(){return"sprite"},t}(n(1).component);t.sprite=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.DrawSystem=void 0;var a=n(2),i=n(0),s=n(4),d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.update=function(e){e.canvas.ctx.clearRect(0,0,e.canvas.element.width,e.canvas.element.height);var t,n=e.canvas.zoom*e.canvas.cam.zoom;e.canvas.ctx.imageSmoothingEnabled=!1;for(var o=0,r=e.getEntitiesWith("TileMap");o<r.length;o++)for(var a=r[o],d=e.getComponentForEntity(a,"TileMap"),c=e.getComponentForEntity(a,"body"),u=new i.v2d,l=0,p=d.data.layers;l<p.length;l++){var h=p[l];if("tilelayer"==h.type){u.Y=h.height,u.X=h.data.length/u.Y;for(var f=0;f<u.Y;f++)for(var y=0;y<u.X;y++){var w=y+f*u.X,v=h.data[w];if(0!=v)v--,(_=new i.v2d).X=v%4,_.Y=Math.floor(v/4),e.canvas.ctx.drawImage(s.i(d.data.tilesets[0].name),8*_.X,8*_.Y,8,8,(c.position.X+8*y)*n,(c.position.Y+8*f)*n,8*n,8*n)}}}for(var m=0,g=e.getEntitiesWith("sprite");m<g.length;m++){a=g[m],c=e.getComponentForEntity(a,"body");var b=e.getComponentForEntity(a,"sprite"),_=i.v2d.create(b.sheet.animations[b.animationID][b.frameID][0],b.sheet.animations[b.animationID][b.frameID][1]);e.canvas.ctx.drawImage(b.sheet.asset,_.X*b.sheet.tilesize.X,_.Y*b.sheet.tilesize.Y,b.sheet.tilesize.X,b.sheet.tilesize.Y,c.position.X*n,c.position.Y*n,b.sheet.tilesize.X*n,b.sheet.tilesize.Y*n)}e.canvas.ctx.font=8*n+"px PressStart2P";for(var x=0,I=e.getEntitiesWith("TextC");x<I.length;x++){a=I[x],c=e.getComponentForEntity(a,"body");for(var S=-1,O=0,k=(d=e.getComponentForEntity(a,"TextC")).message.split("\n");O<k.length;O++){var T=k[O];S++,""!=T&&(e.canvas.ctx.fillStyle="rgba(0, 0, 0, 0.9)",e.canvas.ctx.fillRect((c.position.X-2)*n,(c.position.Y-2+12*S)*n,(320-2*c.position.X+4)*n,12*n),e.canvas.ctx.fillStyle=d.color,e.canvas.ctx.fillText(T,c.position.X*n,(c.position.Y+8+12*S)*n))}}for(var Y=0,M=e.get("Fader");Y<M.length;Y++)(t=M[Y]).active&&(e.canvas.ctx.fillStyle="rgba(0, 0, 0, "+Math.round(5*t.faded)/5+")",e.canvas.ctx.fillRect(0,0,320*n,180*n))},t}(a.system);t.DrawSystem=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationSystem=void 0;var o=function(){function e(){}return e.prototype.update=function(e){for(var t,n=0,o=e.get("sprite");n<o.length;n++){var r=(t=o[n]).sheet.animations[t.animationID];t.frameDuration>0?t.frameDuration--:(++t.frameID>=r.length&&(t.frameID=0),t.frameDuration=r[t.frameID][2])}},e}();t.AnimationSystem=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MoveSystem=void 0;var o=n(0),r=function(){function e(){}return e.prototype.update=function(e){for(var t,n=0,r=e.get("body");n<r.length;n++)if(0!=(t=r[n]).velocity.X||0!=t.velocity.Y){var a=new o.v2d;a.X=t.position.X+t.velocity.X,a.Y=t.position.Y+t.velocity.Y;var i=a.X/8+Math.floor((a.Y-12)/8*40);window.tiles.index[i]?(t.velocity.X=0,t.velocity.Y=0):(window.tiles.index[t.index]=0,t.position.X+=t.velocity.X,t.position.Y+=t.velocity.Y,t.index=t.position.X/8+Math.floor((t.position.Y-12)/8*40),window.tiles.index[t.index]=1,t.velocity.X=0,t.velocity.Y=0)}},e}();t.MoveSystem=r},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AIPlayer=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.actNow=!1,t.speed=8,t}return r(t,e),t.prototype.class=function(){return"AIPlayer"},t}(n(1).component);t.AIPlayer=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AIPlayerSystem=void 0;var a=n(2),i=n(3),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.update=function(e){for(var t=0,n=e.getEntitiesWith("AIPlayer");t<n.length;t++){var o=n[t],r=!1,a=!1,s=!1,d=e.getComponentForEntity(+o,"AIPlayer"),c=e.getComponentForEntity(+o,"body"),u=e.getComponentForEntity(+o,"sprite");i.input.down("ArrowRight")%8==1&&(c.velocity.X+=d.speed),i.input.down("ArrowLeft")%8==1&&(c.velocity.X-=d.speed),i.input.down("ArrowDown")%8==1&&(c.velocity.Y+=d.speed),i.input.down("ArrowUp")%8==1&&(c.velocity.Y-=d.speed);var l=[c.index-1,c.index+0,c.index+1,c.index-1-40,c.index+0-40,c.index+1-40,c.index-1+40,c.index+0+40,c.index+1+40];if(i.input.down("x")>0)for(var p=0,h=l;p<h.length;p++){var f=h[p];5==window.maps[window.tiles.currentMap].layers[1].data[f]&&(window.maps[window.tiles.currentMap].layers[1].data[f]=6,r=!0,a=!0)}if(i.input.down("c")>0)for(var y=0,w=l;y<w.length;y++){f=w[y];12!=window.maps[window.tiles.currentMap].layers[1].data[f]&&0!=window.maps[window.tiles.currentMap].layers[1].data[f]||(window.maps[window.tiles.currentMap].layers[1].data[f]=18,r=!0,d.actNow=!1)}if(a&&window.sounds["plant"+Math.round(2*Math.random())].play(),0==c.velocity.X&&0==c.velocity.Y||(r=!0,"protagLeft"==u.animationID?u.animationID="protagRight":u.animationID="protagLeft",c.velocity.X<0&&c.position.X<=0&&(c.velocity.X=0),c.velocity.X>0&&c.position.X>=312&&(c.velocity.X=0),c.velocity.Y<0&&c.position.Y<=12&&(c.velocity.Y=0),c.velocity.Y>0&&c.position.Y>=172&&(c.velocity.Y=0)),r){if(d.actNow){f=-1;for(var v=0,m=window.maps[window.tiles.currentMap].layers[1].data;v<m.length;v++){var g=m[v];if(f++,4==g||19==g)for(var b=0,_=[f-1,f+0,f+1,f+0-40,f+0+40];b<_.length;b++){var x=_[b];18==window.maps[window.tiles.currentMap].layers[1].data[x]?(window.maps[window.tiles.currentMap].layers[1].data[x]=19,s=!0):6==window.maps[window.tiles.currentMap].layers[1].data[x]&&(window.maps[window.tiles.currentMap].layers[1].data[x]=11,s=!0)}}}if(d.actNow=!d.actNow,window.maps[window.tiles.currentMap].properties,-1==window.maps[window.tiles.currentMap].layers[1].data.indexOf(5)&&-1==window.maps[window.tiles.currentMap].layers[1].data.indexOf(6)){for(var I=0,S=window.maps[window.tiles.currentMap].properties;I<S.length;I++){var O=S[I];"nextScene"==O.name&&(e.nextScene=O.value)}if(null==e.nextScene)throw new Error("No next scene!");window.sounds.won.play()}}s&&!a&&window.sounds.water.play()}},t}(a.system);t.AIPlayerSystem=s},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TileMap=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.create=function(e){var n=new t;n.data=window.maps[e],window.tiles.currentMap=e;for(var o=-1,r=0,a=n.data.layers[1].data;r<a.length;r++){var i=a[r];o++,-1!=window.tiles.solids.indexOf(i)&&(window.tiles.index[o]=i)}return n},t.prototype.class=function(){return"TileMap"},t}(n(1).component);t.TileMap=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextC=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color="#999",t}return r(t,e),t.create=function(e){var n=new t;return n.message=e,n},t.prototype.class=function(){return"TextC"},t}(n(1).component);t.TextC=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextRead=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.messageID=0,t.wait=0,t}return r(t,e),t.create=function(e,n){var o=new t;return o.messages=e,o.nextScene=n,o},t.prototype.class=function(){return"TextRead"},t}(n(1).component);t.TextRead=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.TextReadSystem=void 0;var a=n(2),i=n(3),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slowmo=!1,t}return r(t,e),t.prototype.update=function(e){var t=e.get("Fader");if(t.length&&!(t=t[0]).active)for(var n=0,o=e.getEntitiesWith("TextRead");n<o.length;n++){var r=o[n],a=e.getComponentForEntity(r,"TextRead"),s=e.getComponentForEntity(r,"TextC");if(a.messageID>=a.messages.length)t.nextScene=a.nextScene,t.active=!0;else{var d=a.messages[a.messageID];if("p"==d.substr(0,1)?(s.color="#76428A",d=d.substr(1)):"r"==d.substr(0,1)?(s.color="#551111",d=d.substr(1)):s.color="#999",s.message.length!=d.length)if(a.wait>0)a.wait--;else{a.wait=this.slowmo?3:1;var c=d.substr(s.message.length,1);"\n"==c?a.wait=10:"\t"==c?this.slowmo=!0:s.message.length%2==0&&window.sounds["text"+(Math.round(2*Math.random())+("#551111"==s.color?3:0))].play(),s.message+=c}else 1==i.input.down(" ")&&(s.message="",a.messageID++,this.slowmo=!1)}}},t}(a.system);t.TextReadSystem=s},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.FaderSystem=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.update=function(e){for(var t,n=0,o=e.get("Fader");n<o.length;n++)(t=o[n]).active&&(t.direction?t.faded<1?t.faded+=.01:e.nextScene=t.nextScene:t.faded>0?t.faded-=.01:(t.active=!1,t.direction=!0))},t}(n(2).system);t.FaderSystem=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Fader=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.active=!0,t.direction=!1,t.faded=1,t}return r(t,e),t.create=function(e){var n=new t;return n.nextScene=e,n},t.prototype.class=function(){return"Fader"},t}(n(1).component);t.Fader=a}]);