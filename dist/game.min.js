!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.v2d=void 0;var o=function(){function t(){this.X=0,this.Y=0}return t.create=function(e,n){var o=new t;return o.X=e,o.Y=n,o},t}();e.v2d=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.component=void 0;var o=function(){function t(){this.active=!0}return t.prototype.class=function(){throw new Error("No class name!")},t}();e.component=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.i=void 0,e.i=function(t){return document.querySelector('[src="assets/'+t+'.png"]')}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.system=void 0;var o=function(){function t(){}return t.prototype.update=function(t){throw new Error("System not implemented!")},t}();e.system=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.input=void 0;var o=function(){function t(){}return t.init=function(){t.keys={down:[],held:[]},window.addEventListener("keydown",(function(e){return t.key(e.key,!0)})),window.addEventListener("keyup",(function(e){return t.key(e.key,!1)}))},t.key=function(e,n){t.keys.down[e]||(t.keys.down[e]=0),t.keys.held[e]||(t.keys.held[e]=0),t.keys.held[e]=n?Math.max(1,t.keys.held[e]+1):-1},t.update=function(){for(var e in t.keys.held)t.held(e)<=0?t.keys.down[e]=Math.max(Math.min(-1,t.down(e)-1),-80):t.keys.down[e]=Math.max(1,t.down(e)+1)},t.down=function(e){return t.keys.down[e]?t.keys.down[e]:0},t.held=function(e){return t.keys.held[e]?t.keys.held[e]:0},t}();e.input=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),r=n(8),i=n(9),a=n(0),s=n(10),c=n(11),u=n(12),p=n(13),d=n(4),l=n(14),f=n(15),y=n(16),v=n(17),h=n(18);window.addEventListener("load",(function(){var t,e=o.canvas.create("c",320,180),n=[i.SpriteSheet.create("8x8",a.v2d.create(8,8),{protagLeft:[[0,0,0]],protagRight:[[1,0,0]],weed:[[2,1,15],[3,1,15],[0,2,15],[1,2,15]],corn:[[2,2,0]],fire:[[0,3,5],[1,3,5],[2,3,5],[3,3,5]]}),i.SpriteSheet.create("endcard",a.v2d.create(320,180),{only:[[0,0,0]]})],w={firstScene:function(){var e;e=t.new(),t.add(e,v.TileMap.create("farm1")),t.add(e,s.body.create(0,12)),e=t.new(),t.add(e,new f.AIPlayer),t.add(e,s.body.create(192,124)),t.add(e,c.sprite.create(n[0],"protagLeft")),e=t.new(),t.add(e,s.body.create(2,2)),t.add(e,h.TextC.create("Spring 1953")),e=t.new(),t.add(e,s.body.create(192,2)),t.add(e,h.TextC.create("Seed [X] Dig [C]"))},secondScene:function(){var e;e=t.new(),t.add(e,s.body.create(0,12)),t.add(e,c.sprite.create(n[0],"fire"))}},m=null;setInterval((function(){(null==t&&(m="firstScene")||null!=t.nextScene&&(m=t.nextScene))&&((t=function(t){var e=r.world.create();return e.canvas=t,e.systems.push(new y.AIPlayerSystem),e.systems.push(new l.MoveSystem),e.systems.push(new p.AnimationSystem),e.systems.push(new u.DrawSystem),e}(e)).spriteSheets=n,w[m](),m=null),t.focused&&(t.progress(),d.input.update())}),1e3/60),document.addEventListener("focus",(function(){return t.focused=!0})),document.addEventListener("blur",(function(){return t.focused=!1})),d.input.init()}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.canvas=void 0;var o=n(0),r=n(7),i=function(){function t(){}return t.create=function(e,n,i){var a=new t;return a.cam=r.camera.create(),a.size=o.v2d.create(n,i),a.zoom=1,a.element=document.getElementById(e),a.ctx=a.element.getContext("2d"),a.refresh(),window.addEventListener("resize",(function(){return a.refresh()})),a},t.prototype.refresh=function(){var t=o.v2d.create(window.innerWidth,window.innerHeight);this.zoom=Math.min(t.X/this.size.X,t.Y/this.size.Y),this.zoom>1&&(this.zoom=Math.floor(this.zoom)),this.element.width=this.size.X*this.zoom,this.element.height=this.size.Y*this.zoom},t}();e.canvas=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.camera=void 0;var o=n(0),r=function(){function t(){}return t.create=function(){var e=new t;return e.position=o.v2d.create(0,0),e.zoom=1,e},t}();e.camera=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.world=void 0;var o=function(){function t(){this.entityCount=0,this.focused=!0,this.nextScene=null}return t.create=function(){var e=new t;return e.components={all:[],types:{}},e.systems=[],e},t.prototype.new=function(){return this.entityCount++},t.prototype.addComponent=function(t){var e=t.class();this.components.all.push(t),this.components.types[e]||(this.components.types[e]=[]),this.components.types[e].push(t)},t.prototype.add=function(t,e){e.entity=t,this.addComponent(e)},t.prototype.remove=function(t){for(var e=[],n=0;n<this.components.all.length;n++){var o=this.components.all[n];if(o.entity==t){e.push(n);var r=o.class(),i=void 0;i=this.components.types[r].indexOf(o),this.components.types[r].splice(i,1)}}for(var a=0,s=e;a<s.length;a++){i=s[a];this.components.all.splice(i,1)}},t.prototype.progress=function(){for(var t=0,e=this.systems;t<e.length;t++){e[t].update(this)}},t.prototype.get=function(t){var e;return null!==(e=this.components.types[t])&&void 0!==e?e:[]},t.prototype.getEntitiesWith=function(t){for(var e=[],n=0,o=this.get(t);n<o.length;n++){var r=o[n];e.push(r.entity)}return e},t.prototype.getComponentForEntity=function(t,e){for(var n=0,o=this.get(e);n<o.length;n++){var r=o[n];if(r.entity==t)return r}return null},t}();e.world=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SpriteSheet=void 0;var o=n(2),r=function(){function t(){}return t.create=function(e,n,r){var i=new t;return i.asset=o.i(e),i.filename=e,i.animations=r,i.tilesize=n,i},t}();e.SpriteSheet=r},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.body=void 0;var i=n(0),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.create=function(t,n,o){void 0===o&&(o=!0);var r=new e;return r.position=i.v2d.create(t,n),r.velocity=new i.v2d,o&&(r.index=r.position.X/8+Math.floor((r.position.Y-12)/8*40),window.tiles.index[r.index]=1),r},e.prototype.class=function(){return"body"},e}(n(1).component);e.body=a},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.sprite=void 0;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.flipX=!1,e.frameID=0,e.frameDuration=0,e}return r(e,t),e.create=function(t,n){var o=new e;return o.animationID=n,o.sheet=t,o},e.prototype.class=function(){return"sprite"},e}(n(1).component);e.sprite=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.DrawSystem=void 0;var i=n(3),a=n(0),s=n(2),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(t){t.canvas.ctx.clearRect(0,0,t.canvas.element.width,t.canvas.element.height);var e=t.canvas.zoom*t.canvas.cam.zoom;t.canvas.ctx.imageSmoothingEnabled=!1;for(var n=0,o=t.getEntitiesWith("TileMap");n<o.length;n++)for(var r=o[n],i=t.getComponentForEntity(r,"TileMap"),c=t.getComponentForEntity(r,"body"),u=new a.v2d,p=0,d=i.data.layers;p<d.length;p++){var l=d[p];if("tilelayer"==l.type){u.Y=l.height,u.X=l.data.length/u.Y;for(var f=0;f<u.Y;f++)for(var y=0;y<u.X;y++){var v=y+f*u.X,h=l.data[v];if(0!=h)h--,(g=new a.v2d).X=h%4,g.Y=Math.floor(h/4),t.canvas.ctx.drawImage(s.i(i.data.tilesets[0].name),8*g.X,8*g.Y,8,8,(c.position.X+8*y)*e,(c.position.Y+8*f)*e,8*e,8*e)}}}for(var w=0,m=t.getEntitiesWith("sprite");w<m.length;w++){r=m[w],c=t.getComponentForEntity(r,"body");var _=t.getComponentForEntity(r,"sprite"),g=a.v2d.create(_.sheet.animations[_.animationID][_.frameID][0],_.sheet.animations[_.animationID][_.frameID][1]);t.canvas.ctx.drawImage(_.sheet.asset,g.X*_.sheet.tilesize.X,g.Y*_.sheet.tilesize.Y,_.sheet.tilesize.X,_.sheet.tilesize.Y,c.position.X*e,c.position.Y*e,_.sheet.tilesize.X*e,_.sheet.tilesize.Y*e)}t.canvas.ctx.font=8*e+"px PressStart2P",t.canvas.ctx.fillStyle="#999";for(var x=0,b=t.getEntitiesWith("TextC");x<b.length;x++){r=b[x],c=t.getComponentForEntity(r,"body"),i=t.getComponentForEntity(r,"TextC");t.canvas.ctx.fillText(i.message,c.position.X*e,(c.position.Y+8)*e)}},e}(i.system);e.DrawSystem=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationSystem=void 0;var o=function(){function t(){}return t.prototype.update=function(t){for(var e,n=0,o=t.get("sprite");n<o.length;n++){var r=(e=o[n]).sheet.animations[e.animationID];e.frameDuration>0?e.frameDuration--:(++e.frameID>=r.length&&(e.frameID=0),e.frameDuration=r[e.frameID][2])}},t}();e.AnimationSystem=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MoveSystem=void 0;var o=n(0),r=function(){function t(){}return t.prototype.update=function(t){for(var e,n=0,r=t.get("body");n<r.length;n++)if(0!=(e=r[n]).velocity.X||0!=e.velocity.Y){var i=new o.v2d;i.X=e.position.X+e.velocity.X,i.Y=e.position.Y+e.velocity.Y;var a=i.X/8+Math.floor((i.Y-12)/8*40);window.tiles.index[a]?(e.velocity.X=0,e.velocity.Y=0):(window.tiles.index[e.index]=0,e.position.X+=e.velocity.X,e.position.Y+=e.velocity.Y,e.index=e.position.X/8+Math.floor((e.position.Y-12)/8*40),window.tiles.index[e.index]=1,e.velocity.X=0,e.velocity.Y=0)}},t}();e.MoveSystem=r},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.AIPlayer=void 0;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actNow=!1,e.speed=8,e}return r(e,t),e.prototype.class=function(){return"AIPlayer"},e}(n(1).component);e.AIPlayer=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.AIPlayerSystem=void 0;var i=n(3),a=n(4),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(t){for(var e=0,n=t.getEntitiesWith("AIPlayer");e<n.length;e++){var o=n[e],r=!1,i=t.getComponentForEntity(+o,"AIPlayer"),s=t.getComponentForEntity(+o,"body"),c=t.getComponentForEntity(+o,"sprite");a.input.down("ArrowRight")%8==1&&(s.velocity.X+=i.speed),a.input.down("ArrowLeft")%8==1&&(s.velocity.X-=i.speed),a.input.down("ArrowDown")%8==1&&(s.velocity.Y+=i.speed),a.input.down("ArrowUp")%8==1&&(s.velocity.Y-=i.speed);var u=[s.index-1,s.index+0,s.index+1,s.index-1-40,s.index+0-40,s.index+1-40,s.index-1+40,s.index+0+40,s.index+1+40];if(a.input.down("x")>0)for(var p=0,d=u;p<d.length;p++){var l=d[p];5==window.maps[window.tiles.currentMap].layers[1].data[l]&&(window.maps[window.tiles.currentMap].layers[1].data[l]=6,r=!0)}if(a.input.down("c")>0)for(var f=0,y=u;f<y.length;f++){l=y[f];12!=window.maps[window.tiles.currentMap].layers[1].data[l]&&0!=window.maps[window.tiles.currentMap].layers[1].data[l]||(window.maps[window.tiles.currentMap].layers[1].data[l]=18,r=!0,i.actNow=!1)}if(0==s.velocity.X&&0==s.velocity.Y||(r=!0,"protagLeft"==c.animationID?c.animationID="protagRight":c.animationID="protagLeft",s.velocity.X<0&&s.position.X<=0&&(s.velocity.X=0),s.velocity.X>0&&s.position.X>=312&&(s.velocity.X=0),s.velocity.Y<0&&s.position.Y<=12&&(s.velocity.Y=0),s.velocity.Y>0&&s.position.Y>=172&&(s.velocity.Y=0)),r){if(i.actNow){l=-1;for(var v=0,h=window.maps[window.tiles.currentMap].layers[1].data;v<h.length;v++){var w=h[v];if(l++,4==w||19==w)for(var m=0,_=[l-1,l+0,l+1,l+0-40,l+0+40];m<_.length;m++){var g=_[m];18==window.maps[window.tiles.currentMap].layers[1].data[g]?window.maps[window.tiles.currentMap].layers[1].data[g]=19:6==window.maps[window.tiles.currentMap].layers[1].data[g]&&(window.maps[window.tiles.currentMap].layers[1].data[g]=11)}}}i.actNow=!i.actNow,-1==window.maps[window.tiles.currentMap].layers[1].data.indexOf(5)&&-1==window.maps[window.tiles.currentMap].layers[1].data.indexOf(6)&&(t.nextScene="secondScene")}}},e}(i.system);e.AIPlayerSystem=s},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.TileMap=void 0;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.create=function(t){var n=new e;n.data=window.maps[t],window.tiles.currentMap=t;for(var o=-1,r=0,i=n.data.layers[1].data;r<i.length;r++){var a=i[r];o++,-1!=window.tiles.solids.indexOf(a)&&(window.tiles.index[o]=a)}return n},e.prototype.class=function(){return"TileMap"},e}(n(1).component);e.TileMap=i},function(t,e,n){"use strict";var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.TextC=void 0;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.create=function(t){var n=new e;return n.message=t,n},e.prototype.class=function(){return"TextC"},e}(n(1).component);e.TextC=i}]);